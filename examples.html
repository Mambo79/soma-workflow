<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Examples &mdash; soma-workflow version 2.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/icon_small.ico"/>
    <link rel="top" title="soma-workflow version 2.8 documentation" href="index.html" />
    <link rel="next" title="MPI workflow runner —beta—" href="MPI_workflow_runner.html" />
    <link rel="prev" title="Graphical User Interface" href="gui.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="MPI_workflow_runner.html" title="MPI workflow runner —beta—"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">soma-workflow version 2.8 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="examples">
<span id="id1"></span><h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>You will find here a set of examples. The objective is to illustrate how to
build simple to more complex workflows and submit them to soma-workflow.</p>
<dl class="docutils">
<dt>The content of the jobs is not relevant here:</dt>
<dd><ul class="first last simple">
<li>The &#8220;sleep&#8221; command was used in the examples to stand for any job.</li>
<li>The &#8220;cp&#8221; command was used in the examples to stand for a job reading a file
and writing another file.</li>
</ul>
</dd>
</dl>
<p>However, <strong>the job examples were chosen to enable anyone to copy the examples and run them directly on his machine</strong>:</p>
<div class="contents local topic" id="id2">
<p class="topic-title first">Examples</p>
<ul class="simple">
<li><a class="reference internal" href="#simple-workflows" id="id3">Simple workflows</a><ul>
<li><a class="reference internal" href="#basic-example" id="id4">Basic example</a></li>
<li><a class="reference internal" href="#workflow-with-group" id="id5">Workflow with Group</a></li>
</ul>
</li>
<li><a class="reference internal" href="#go-further-with-the-client-server-mode" id="id6">Go further with the client-server mode</a></li>
<li><a class="reference internal" href="#workflows-with-filetransfer" id="id7">Workflows with FileTransfer</a><ul>
<li><a class="reference internal" href="#basic-file-transfer" id="id8">Basic file transfer</a></li>
<li><a class="reference internal" href="#working-directory-transfer" id="id9">Working directory transfer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflows-with-sharedresourcepath" id="id10">Workflows with SharedResourcePath</a></li>
</ul>
</div>
<div class="section" id="simple-workflows">
<h2><a class="toc-backref" href="#id3">Simple workflows</a><a class="headerlink" href="#simple-workflows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-example">
<h3><a class="toc-backref" href="#id4">Basic example</a><a class="headerlink" href="#basic-example" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<a class="reference internal image-reference" href="_images/simple_example.png"><img alt="_images/simple_example.png" src="_images/simple_example.png" style="width: 166.8px; height: 147.0px;" /></a>
<p class="caption">Simple example: 4 jobs with dependencies.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">Helper</span>


<span class="c"># create the workflow:</span>

<span class="n">job_1</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;job 1&quot;</span><span class="p">)</span>
<span class="n">job_2</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;job 2&quot;</span><span class="p">)</span>
<span class="n">job_3</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;job 3&quot;</span><span class="p">)</span>
<span class="n">job_4</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;job 4&quot;</span><span class="p">)</span>

<span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_2</span><span class="p">,</span> <span class="n">job_3</span><span class="p">,</span> <span class="n">job_4</span><span class="p">]</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_2</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_3</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_2</span><span class="p">,</span> <span class="n">job_4</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_3</span><span class="p">,</span> <span class="n">job_4</span><span class="p">)]</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="n">jobs</span><span class="p">,</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="n">dependencies</span><span class="p">)</span>

<span class="c"># save the workflow into a file</span>
<span class="n">Helper</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&quot;/tmp/workflow_example&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script, then open the GUI (command: &#8220;soma_workflow_gui&#8221;).</p>
<dl class="docutils">
<dt>In the GUI, you can now:</dt>
<dd><ul class="first last simple">
<li>Open the workflow file.</li>
<li>Submit the workflow to the computing resource of your choice.</li>
<li>Monitor the workflow execution:</li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="_images/simple_example_gui.png"><img alt="_images/simple_example_gui.png" src="_images/simple_example_gui.png" style="width: 848.4px; height: 509.4px;" /></a>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <a class="reference internal" href="workflow_creation.html#workflow-creation-api"><em>workflow creation API</em></a> for a
full description of job and workflow options.</p>
</div>
</div>
<div class="section" id="workflow-with-group">
<h3><a class="toc-backref" href="#id5">Workflow with Group</a><a class="headerlink" href="#workflow-with-group" title="Permalink to this headline">¶</a></h3>
<p>Creating groups can be useful to organize jobs within workflows for displaying
purpose. Groups do not have any impact on the execution of workflows.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/simple_example_group.png"><img alt="_images/simple_example_group.png" src="_images/simple_example_group.png" style="width: 356.4px; height: 172.2px;" /></a>
<p class="caption">Simple example with a group: 30 jobs are in the group &#8220;my 30 jobs&#8221;.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Helper</span>


<span class="c"># create the workflow:</span>
<span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">group_elements</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">first_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;10&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;first job&quot;</span><span class="p">)</span>
<span class="n">last_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;10&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;last job&quot;</span><span class="p">)</span>

<span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_job</span><span class="p">)</span>
<span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_job</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
  <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;sleep&quot;</span><span class="p">,</span> <span class="s">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;job &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

  <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

  <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">first_job</span><span class="p">,</span> <span class="n">job</span><span class="p">))</span>
  <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">job</span><span class="p">,</span> <span class="n">last_job</span><span class="p">))</span>

  <span class="n">group_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>


<span class="n">thirty_jobs_group</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">group_elements</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="s">&quot;my 30 jobs&quot;</span><span class="p">)</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="n">jobs</span><span class="p">,</span>
                    <span class="n">dependencies</span><span class="o">=</span> <span class="n">dependencies</span><span class="p">,</span>
                    <span class="n">root_group</span><span class="o">=</span><span class="p">[</span><span class="n">first_job</span><span class="p">,</span> <span class="n">thirty_jobs_group</span><span class="p">,</span> <span class="n">last_job</span><span class="p">])</span>

<span class="c"># save the workflow into a file</span>
<span class="n">Helper</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&quot;/tmp/workflow_example&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script, then open the GUI (command: &#8220;soma_workflow_gui&#8221;) to
open, submit and monitor your workflow:</p>
<a class="reference internal image-reference" href="_images/simple_example_group_gui.png"><img alt="_images/simple_example_group_gui.png" src="_images/simple_example_group_gui.png" style="width: 808.8px; height: 507.6px;" /></a>
<p>The 30 jobs within the group can be extended (visible) or collapsed (hidden).</p>
</div>
</div>
<div class="section" id="go-further-with-the-client-server-mode">
<h2><a class="toc-backref" href="#id6">Go further with the client-server mode</a><a class="headerlink" href="#go-further-with-the-client-server-mode" title="Permalink to this headline">¶</a></h2>
<p>When the computing resource you want to use is configured in the mono process
mode (this is the case if you use your multi core machine without special
configuration), all the workflows must run in a single session and the workflow
executions are stopped when this session is closed. In this case, it is thus
safer to save the workflows into files and submit them through the same GUI
you will use to monitor the execution (the workflows will be stopped
if you close the GUI).</p>
<p>The client-server mode is much more flexible. When you want to submit a workflow
to a computing resource configured in the client-server mode (remote cluster for
example), you can submit it directly to the computing resource in the Python
script instead of saving the workflow into a file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">WorkflowController</span>

<span class="c"># workflow creation as described in the examples</span>
<span class="c"># no need to save the workflow into a file</span>

<span class="c"># submit the workflow to computing resource (configured in the client-server mode)</span>

<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s">&quot;simple example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>You can now close and open the GUI at any time and even shut down you computer.
It will not interrupt the workflow execution.</strong></p>
</div>
<div class="section" id="workflows-with-filetransfer">
<span id="file-transfer-examples"></span><h2><a class="toc-backref" href="#id7">Workflows with FileTransfer</a><a class="headerlink" href="#workflows-with-filetransfer" title="Permalink to this headline">¶</a></h2>
<p>The file transfers are optional. However, they can be useful if you use a remote
computing resource and there is no shared file system between
your machine and the computing resource (see <a class="reference internal" href="concepts.html#file-transfers-concept"><em>File Transfer</em></a>).</p>
<p>These examples show how to create workflows managing file transfers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An easy way to deal with file transfers is to transfer a working
directory and work with relative paths (see <a class="reference internal" href="#working-directory-transfer-example"><em>Working directory transfer</em></a>).</p>
</div>
<div class="section" id="basic-file-transfer">
<h3><a class="toc-backref" href="#id8">Basic file transfer</a><a class="headerlink" href="#basic-file-transfer" title="Permalink to this headline">¶</a></h3>
<p>To run this example, create first the file &#8220;/tmp/soma_workflow_examples/myfile&#8221;
with any content. It will stand for an input file to transfer.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c"># FileTransfer creation for input files</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">client_path</span><span class="o">=</span><span class="s">&quot;/tmp/soma_workflow_examples/myfile&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&quot;myfile&quot;</span><span class="p">)</span>

<span class="c"># FileTransfer creation for output files</span>
<span class="n">copy_of_myfile</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">client_path</span><span class="o">=</span><span class="s">&quot;/tmp/soma_workflow_examples/copy_of_myfile&quot;</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="s">&quot;copy of my file&quot;</span><span class="p">)</span>

<span class="c"># Job and Workflow</span>
<span class="n">copy_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;cp&quot;</span><span class="p">,</span> <span class="n">myfile</span><span class="p">,</span> <span class="n">copy_of_myfile</span><span class="p">],</span>
              <span class="n">name</span><span class="o">=</span><span class="s">&quot;copy&quot;</span><span class="p">,</span>
              <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">myfile</span><span class="p">],</span>
              <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">copy_of_myfile</span><span class="p">])</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">copy_job</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>



<span class="c"># submit the workflow</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="s">&quot;simple transfer&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script and open the GUI:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui.png"><img alt="_images/file_transfer_example_gui.png" src="_images/file_transfer_example_gui.png" style="width: 754.8px; height: 507.6px;" /></a>
<p>Transfer the input files using the &#8220;Transfer Input Files&#8221; button:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_1.png"><img alt="_images/file_transfer_example_gui_1.png" src="_images/file_transfer_example_gui_1.png" style="width: 514.4px; height: 187.2px;" /></a>
<p>The job will start as soon as the transfers ended:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_2.png"><img alt="_images/file_transfer_example_gui_2.png" src="_images/file_transfer_example_gui_2.png" style="width: 514.4px; height: 185.6px;" /></a>
<p>When the workflow is done, transfer the output files using the
&#8220;Transfer Output Files&#8221; button:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_3.png"><img alt="_images/file_transfer_example_gui_3.png" src="_images/file_transfer_example_gui_3.png" style="width: 514.4px; height: 186.4px;" /></a>
<p>The progression and the end of the transfer are visible in the GUI.</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_4.png"><img alt="_images/file_transfer_example_gui_4.png" src="_images/file_transfer_example_gui_4.png" style="width: 513.6px; height: 186.4px;" /></a>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="status_list.html#file-transfer-status"><em>File Transfer status</em></a></p>
</div>
</div>
<div class="section" id="working-directory-transfer">
<span id="working-directory-transfer-example"></span><h3><a class="toc-backref" href="#id9">Working directory transfer</a><a class="headerlink" href="#working-directory-transfer" title="Permalink to this headline">¶</a></h3>
<p>An easy way to work with file transfers is to transfer a working directory
containing all the files you need and then use only relative file paths in your
jobs.</p>
<p>In this example, the working directory contains 2 files: myfile1 and myfile2.
The workflow contains 2 jobs which will modify the working directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c"># Creation of the FileTransfer object to transfer the working directory</span>
<span class="n">my_working_directory</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                    <span class="n">client_path</span><span class="o">=</span><span class="s">&quot;/tmp/my_working_directory&quot;</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s">&quot;working directory&quot;</span><span class="p">)</span>

<span class="c"># Jobs and Workflow</span>
<span class="c"># Do not forget to set the working_directory argument when creating the jobs</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;cp&quot;</span><span class="p">,</span> <span class="s">&quot;myfile1&quot;</span> <span class="p">,</span> <span class="s">&quot;copy_of_myfile1&quot;</span><span class="p">],</span>
           <span class="n">name</span><span class="o">=</span><span class="s">&quot;job1&quot;</span><span class="p">,</span>
           <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">working_directory</span><span class="o">=</span><span class="n">my_working_directory</span><span class="p">)</span>

<span class="n">job2</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;cp&quot;</span><span class="p">,</span> <span class="s">&quot;myfile2&quot;</span> <span class="p">,</span> <span class="s">&quot;copy_of_myfile2&quot;</span><span class="p">],</span>
           <span class="n">name</span><span class="o">=</span><span class="s">&quot;job2&quot;</span><span class="p">,</span>
           <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">working_directory</span><span class="o">=</span><span class="n">my_working_directory</span><span class="p">)</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>


<span class="c"># submit the workflow</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s">&quot;working directory transfer example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script and monitor the execution of the workflow using
the GUI (soma_workflow_gui command):</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui.png"><img alt="_images/wd_transfer_example_gui.png" src="_images/wd_transfer_example_gui.png" style="width: 657.6px; height: 477.6px;" /></a>
<p>Transfer the working directory to the computing resource using the &#8220;Transfer
Input Files&#8221; button and wait for the jobs to execute:</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui_1.png"><img alt="_images/wd_transfer_example_gui_1.png" src="_images/wd_transfer_example_gui_1.png" style="width: 656.0px; height: 481.6px;" /></a>
<p>Transfer the working directory back using the &#8220;Transfer Output Files&#8221; button:</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui_2.png"><img alt="_images/wd_transfer_example_gui_2.png" src="_images/wd_transfer_example_gui_2.png" style="width: 660.0px; height: 482.4px;" /></a>
<p>The working directory on your machine should now contains the files: myfile1, myfile2,
copy_of_myfile1 and copy_of_myfile2.</p>
</div>
</div>
<div class="section" id="workflows-with-sharedresourcepath">
<span id="shared-resource-path-examples"></span><h2><a class="toc-backref" href="#id10">Workflows with SharedResourcePath</a><a class="headerlink" href="#workflows-with-sharedresourcepath" title="Permalink to this headline">¶</a></h2>
<p>As file transfers, shared resource paths are optional but can be useful if
you use a remote computing resource and there is no shared file system between
your machine and the computing resource.</p>
<p>SharedResourcePath are convenient when a copy of the data already exist on the
computing resource file system (see <a class="reference internal" href="concepts.html#shared-resource-path-concept"><em>Shared Resource Path</em></a>).</p>
<p>To run this example:</p>
<ol class="arabic simple">
<li>Create the directory &#8220;/tmp/soma_workflow_examples&#8221; and the file &#8220;/tmp/soma_workflow_examples/myfile&#8221; with any content you like. This directory will stand for the data you want to process.</li>
<li>Create the same data at any location on the computing resource file system, for example &#8220;$HOME/soma_workflow_examples/myfile&#8221;. It will stand for the copy of the data on the computing resource.</li>
<li>On the computing resource file system, create a translation file at the location &#8220;$HOME/translation_example&#8221; for example. It will contain, the correspondences between identifiers and path:</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">my_example_dir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">toto</span><span class="o">/</span><span class="n">soma_workflow_examples</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Still on the computing resource side, register the translation path in the configuration file under the namespace &#8220;MyApp&#8221; (see <a class="reference internal" href="install_config.html#conf-server-option"><em>Configuration items optional on the server side:</em></a>):</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>PATH_TRANSLATION_FILES = MyApp{/home/toto/translation_example}
</pre></div>
</div>
</div></blockquote>
<p>Run the script to create and submit the workflow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">SharedResourcePath</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c"># SharedResourcePath creation for the input file.</span>
<span class="c"># The input file is read direclty in the data directory located on the</span>
<span class="c"># the computing resource side.</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">SharedResourcePath</span><span class="p">(</span><span class="n">relative_path</span><span class="o">=</span><span class="s">&quot;myfile&quot;</span><span class="p">,</span>
                            <span class="n">namespace</span><span class="o">=</span><span class="s">&quot;MyApp&quot;</span><span class="p">,</span>
                            <span class="n">uuid</span><span class="o">=</span><span class="s">&quot;my_example_dir&quot;</span><span class="p">)</span>

<span class="c"># FileTransfer creation for the output file.</span>
<span class="c"># That way the output file will not be written in the data directory</span>
<span class="c"># located on the computing resource file system.</span>
<span class="n">copy_of_myfile</span> <span class="o">=</span>  <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                               <span class="n">client_path</span><span class="o">=</span><span class="s">&quot;/tmp/soma_workflow_examples/copy_of_myfile&quot;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="s">&quot;copy of my file&quot;</span><span class="p">)</span>

<span class="c"># Job and Workflow creation</span>
<span class="n">copy_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;cp&quot;</span><span class="p">,</span> <span class="n">myfile</span><span class="p">,</span> <span class="n">copy_of_myfile</span><span class="p">],</span>
              <span class="n">name</span><span class="o">=</span><span class="s">&quot;copy&quot;</span><span class="p">,</span>
              <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">copy_of_myfile</span><span class="p">])</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">copy_job</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>

<span class="c"># workflow submission</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s">&quot;DSV_cluster&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s">&quot;shared resource path example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Open the GUI to monitor the workflow. Once the execution is done, transfer back
the output files.</p>
<p>The data directory &#8220;/tmp/soma_workflow_examples/&#8221; on your machine  should now
contains the file copy_of_myfile.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_white_small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#simple-workflows">Simple workflows</a><ul>
<li><a class="reference internal" href="#basic-example">Basic example</a></li>
<li><a class="reference internal" href="#workflow-with-group">Workflow with Group</a></li>
</ul>
</li>
<li><a class="reference internal" href="#go-further-with-the-client-server-mode">Go further with the client-server mode</a></li>
<li><a class="reference internal" href="#workflows-with-filetransfer">Workflows with FileTransfer</a><ul>
<li><a class="reference internal" href="#basic-file-transfer">Basic file transfer</a></li>
<li><a class="reference internal" href="#working-directory-transfer">Working directory transfer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflows-with-sharedresourcepath">Workflows with SharedResourcePath</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gui.html"
                        title="previous chapter">Graphical User Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="MPI_workflow_runner.html"
                        title="next chapter">MPI workflow runner &#8212;<strong>beta</strong>&#8212;</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/examples.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="MPI_workflow_runner.html" title="MPI workflow runner —beta—"
             >next</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             >previous</a> |</li>
        <li><a href="index.html">soma-workflow version 2.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011 CEA, Neurospin, France, CATI, France.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>